var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,o=(t,a,n)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[a]=n,r=(e,t,a)=>(o(e,"symbol"!=typeof t?t+"":t,a),a);import{r as l,R as c,M as s,F as i,B as m,v as d,a as u,b}from"./vendor.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var p="PoETradeHelper_Bookmarks",k="PoETradeHelper_History",f="PoETradeHelper_Settings";class h extends Array{constructor(...e){super(...e)}s_push(e,...t){const a=t.filter((t=>!this.find((a=>e(t,a)))));return this.push(...a),this.length}}function E(e){if(e&&7===e.length){return(299*parseInt(e.substr(1,2),16)+587*parseInt(e.substr(3,2),16)+114*parseInt(e.substr(5,2),16))/1e3>=127.5?"#000":"#e2e2e2"}return"#000"}function g(e){return new Promise((t=>{setTimeout(t,e)}))}function y(e){const[t,a]=l.exports.useState(e.bookmarkFolder?e.bookmarkFolder.name:""),[n,o]=l.exports.useState(e.bookmarkFolder?e.bookmarkFolder.bgColor:"#133d62");return c.createElement(s,{show:e.show,onHide:()=>e.setShow(!1),animation:!1},c.createElement(s.Header,{closeButton:!0},c.createElement(s.Title,null,e.bookmarkFolder?"Edit":"Create"," a folder")),c.createElement(s.Body,null,c.createElement(i.Group,{className:"mb-3"},c.createElement(i.Label,{htmlFor:"add_bookmarkFolder_name"},"Name:"),c.createElement(i.Control,{id:"add_bookmarkFolder_name",defaultValue:t,onChange:e=>a(e.currentTarget.value)})),c.createElement(i.Group,{className:"mb-3"},c.createElement(i.Label,{htmlFor:"add_bookmarkFolder_color"},"Background color:"),c.createElement(i.Control,{id:"add_bookmarkFolder_color",defaultValue:n,type:"color",onInput:e=>o(e.currentTarget.value)}))),c.createElement(s.Footer,null,c.createElement(m,{variant:"primary",onClick:function(){t&&n&&(e.bookmarkFolder&&e.editBookmarkFolder?(e.bookmarkFolder.name=t,e.bookmarkFolder.bgColor=n,e.editBookmarkFolder(e.bookmarkFolder)):e.addBookmarkFolder&&e.addBookmarkFolder({id:d(),name:t,bgColor:n,bookmarks:new h}),e.setShow(!1))}},e.bookmarkFolder?"Save":"Add")))}function v(e){const[t,a]=l.exports.useState(e.bookmark?e.bookmark.name:""),[n,o]=l.exports.useState(e.bookmark?e.bookmark.url:window.location.href),[r,u]=l.exports.useState(e.bookmark?e.bookmark.bgColor:"#222222");return l.exports.useEffect((()=>{let t=$("input.multiselect__input");e.bookmark||a(t[0].value?t[0].value:"Any"===t[1].value?"":t[1].value)}),[]),c.createElement(s,{show:e.show,onHide:()=>e.setShow(!1),animation:!1},c.createElement(s.Header,{closeButton:!0},c.createElement(s.Title,null,e.bookmark?"Edit":"Create"," a bookmark")),c.createElement(s.Body,null,c.createElement(i.Group,{className:"mb-3"},c.createElement(i.Label,{htmlFor:"add_bookmark_name"},"Name:"),c.createElement(i.Control,{id:"add_bookmark_name",defaultValue:t,onChange:e=>a(e.currentTarget.value)})),c.createElement(i.Group,{className:"mb-3"},c.createElement(i.Label,{htmlFor:"add_bookmark_url"},"URL:"),c.createElement(i.Control,{id:"add_bookmark_url",defaultValue:n,onChange:e=>o(e.currentTarget.value)})),c.createElement(i.Group,{className:"mb-3"},c.createElement(i.Label,{htmlFor:"add_bookmark_color"},"Background color:"),c.createElement(i.Control,{id:"add_bookmark_color",defaultValue:r,type:"color",onInput:e=>u(e.currentTarget.value)}))),c.createElement(s.Footer,null,c.createElement(m,{variant:"primary",onClick:function(){t&&n&&r&&(e.bookmark&&e.editBookmark?(e.bookmark.name=t,e.bookmark.url=n,e.bookmark.bgColor=r,e.editBookmark(e.bookmark)):e.addBookmark&&e.addBookmark({id:d(),name:t,url:n,bgColor:r}),e.setShow(!1))}},e.bookmark?"Save":"Add")))}function w(e){const[t,a]=l.exports.useState(!1),n={backgroundColor:e.bookmark.bgColor,color:E(e.bookmark.bgColor)};return c.createElement("div",{className:"d-flex"},c.createElement("a",{href:e.bookmark.url,className:"flex-grow-1 p-1 bookmark-entry",style:n},e.bookmark.name),c.createElement("button",{className:"helper-btn",onClick:()=>e.moveBookmark(e.bookmark,-1)},c.createElement("i",{className:"bi bi-chevron-up"})),c.createElement("button",{className:"helper-btn",onClick:()=>e.moveBookmark(e.bookmark,1)},c.createElement("i",{className:"bi bi-chevron-down"})),c.createElement("button",{className:"helper-btn",onClick:()=>a(!0)},c.createElement("i",{className:"bi bi-pencil-fill"})),c.createElement("button",{className:"helper-btn",onClick:()=>e.deleteBookmark(e.bookmark)},c.createElement("i",{className:"bi bi-trash"})),t&&c.createElement(v,{show:t,setShow:a,editBookmark:e.editBookmark,bookmark:e.bookmark}))}function S(e){const[t,a]=l.exports.useState(!1),[n,o]=l.exports.useState(!1),r={backgroundColor:e.folder.bgColor,color:E(e.folder.bgColor)};function s(t){const a=e.folder.bookmarks.findIndex((e=>e.id===t.id));-1!==a&&(e.folder.bookmarks.splice(a,1),e.updateBookmarkFolder(e.folder))}function i(t){const a=e.folder.bookmarks.findIndex((e=>e.id===t.id));-1!==a&&(e.folder.bookmarks[a]=t,e.updateBookmarkFolder(e.folder))}function m(t,a){const n=e.folder.bookmarks.findIndex((e=>e.id===t.id)),o=n+a;-1!==n&&o>=0&&o<e.folder.bookmarks.length&&(u(e.folder.bookmarks,n,o),e.updateBookmarkFolder(e.folder))}return c.createElement("div",{className:"accordion-item mt-1"},c.createElement("h2",{className:"accordion-header",id:"header_"+e.folder.id},c.createElement("button",{className:"accordion-button collapsed",type:"button",style:r,"data-bs-toggle":"collapse","data-bs-target":"#content_"+e.folder.id,"aria-expanded":"false","aria-controls":"content_"+e.folder.id},c.createElement("div",{className:"me-auto"},e.folder.name),c.createElement("button",{className:"helper-btn",onClick:()=>e.moveBookmarkFolder(e.folder,-1)},c.createElement("i",{className:"bi bi-chevron-up"})),c.createElement("button",{className:"helper-btn",onClick:()=>e.moveBookmarkFolder(e.folder,1)},c.createElement("i",{className:"bi bi-chevron-down"})),c.createElement("button",{className:"helper-btn",onClick:()=>o(!0)},c.createElement("i",{className:"bi bi-pencil-fill"})),c.createElement("button",{className:"helper-btn",onClick:()=>e.deleteBookmarkFolder(e.folder)},c.createElement("i",{className:"bi bi-trash"})),n&&c.createElement(y,{show:n,setShow:o,editBookmarkFolder:e.updateBookmarkFolder,bookmarkFolder:e.folder}))),c.createElement("div",{id:"content_"+e.folder.id,className:"accordion-collapse collapse","aria-labelledby":"header_"+e.folder.id},c.createElement("div",{className:"accordion-body"},e.folder.bookmarks.map((e=>c.createElement(w,{key:e.id,bookmark:e,deleteBookmark:s,moveBookmark:m,editBookmark:i}))),c.createElement("button",{className:"helper-btn w-100",onClick:()=>a(!0)},"Add new bookmark"),t&&c.createElement(v,{show:t,setShow:a,addBookmark:function(t){e.folder.bookmarks.s_push(N,t),e.updateBookmarkFolder(e.folder)}}))))}const N=(e,t)=>e.id===t.id;function C(){const[e,t]=l.exports.useState(new h),[a,n]=l.exports.useState(!1),o=l.exports.useRef(null);function r(a){const n=new h(...e),o=n.findIndex((e=>e.id===a.id));-1!==o&&(n[o]=a,window.localStorage.setItem(p,JSON.stringify(n)),t(n))}function s(a){const n=new h(...e),o=n.findIndex((e=>e.id===a.id));-1!==o&&(n.splice(o,1),window.localStorage.setItem(p,JSON.stringify(n)),t(n))}function i(a,n){const o=new h(...e),r=o.findIndex((e=>e.id===a.id)),l=r+n;-1!==r&&l>=0&&l<o.length&&(u(o,r,l),window.localStorage.setItem(p,JSON.stringify(o)),t(o))}return l.exports.useEffect((()=>{const a=window.localStorage.getItem(p);a?t(JSON.parse(a)):window.localStorage.setItem(p,JSON.stringify(e))}),[]),c.createElement(c.Fragment,null,c.createElement("div",{className:"d-flex"},c.createElement("button",{className:"helper-btn me-auto",onClick:function(){n(!0)}},"Create a folder"),c.createElement("input",{ref:o,type:"file",style:{display:"none"},onChange:async function(e){const a=e.currentTarget.files;if(a&&a.length>0){console.log(a);const e=await(n=a[0],new Promise((e=>{let t=new FileReader;t.onload=a=>{t.result&&e(t.result.toString())},t.readAsText(n)})));if(e){console.log(e);try{const a=JSON.parse(e);window.localStorage.setItem(p,e),t(new h(...a))}catch{}}}var n}}),c.createElement("button",{className:"helper-btn",onClick:()=>{var e;return null==(e=o.current)?void 0:e.click()}},"Import"),c.createElement("button",{className:"helper-btn",onClick:function(){!function(e,t){const a=document.createElement("a");a.setAttribute("href","data:text/plain;charset=utf-8;base64,"+btoa(t)),a.setAttribute("download",e),document.body.appendChild(a),a.click(),document.body.removeChild(a)}("PoETradeHelper_Bookmarks.json",JSON.stringify(e))}},"Export")),c.createElement("hr",null),c.createElement("div",{className:"accordion"},e.map((e=>c.createElement(S,{key:e.id,folder:e,updateBookmarkFolder:r,deleteBookmarkFolder:s,moveBookmarkFolder:i})))),a&&c.createElement(y,{show:a,setShow:n,addBookmarkFolder:function(a){const n=new h(...e);n.s_push(N,a),window.localStorage.setItem(p,JSON.stringify(n)),t(n)}}))}function x(e){return c.createElement("div",{className:"history-entry"},c.createElement("a",{href:e.entry.url,style:{flexGrow:1}},c.createElement("div",{className:"d-flex"},c.createElement("b",{className:"history-title"},e.entry.title),c.createElement("small",{className:"ms-auto"},function(e){let t=new Date,a=t.getTime();t.setDate(0);let n=a-e;if(n<36e5){let e=Math.floor(n/1e3/60);return e+" minute"+(e<=1?"":"s")+" ago"}if(n<864e5){let e=Math.floor(n/1e3/60/60);return e+" hour"+(e<=1?"":"s")+" ago"}if(n<864e5*t.getDate()){let e=Math.floor(n/1e3/60/60/24);return e+" day"+(e<=1?"":"s")+" ago"}return"a long time ago"}(e.entry.time))),c.createElement("small",{style:{color:"gray"}},"...",e.entry.url.substring(e.entry.url.indexOf("/trade/")))))}function F(){const e=l.exports.useState(0)[1],t=()=>e((e=>e+1)),a=l.exports.useRef([]);function n(e){if("click"===e.type||"keydown"===e.type&&"Enter"===e.key){let e=setInterval((()=>{if(/\/trade\/search\/\w+\/\w+/.test(window.location.pathname)&&(clearInterval(e),0==a.current.length||a.current[a.current.length-1].url!==window.location.href)){let e=$("input.multiselect__input"),n=e[0].value?e[0].value:e[1].value;a.current.push({id:d(),title:n,url:window.location.href,time:Date.now()}),window.localStorage.setItem(k,JSON.stringify(a.current)),t()}}),1e3)}}return l.exports.useEffect((()=>{const e=window.localStorage.getItem(k);if(e){let t=JSON.parse(e);a.current.push(...t)}else window.localStorage.setItem(k,JSON.stringify(a.current));!async function(e){document.body.addEventListener("keydown",e);let t=document.body.querySelector("button.search-btn");for(;!t;)await g(1e3),t=document.body.querySelector("button.search-btn");t.addEventListener("click",e)}(n)}),[]),c.createElement("div",null,c.createElement("button",{className:"helper-btn",onClick:function(){a.current.splice(0,a.current.length),window.localStorage.setItem(k,JSON.stringify(a.current)),t()}},"Clear"),c.createElement("hr",null),a.current.slice().reverse().map((e=>c.createElement(x,{entry:e}))))}let _;function I(e){setInterval((()=>{if(-1===window.location.href.indexOf("exchange")){$(".results span.pull-left:not(.checked)").each(((t,a)=>{let n=$('<button class="btn btn-default whisper-btn">Pin</button>');n.on("click",e),$(a).append(n),$(a).addClass("checked")})),$('span[data-field="price"][helper-checked!="ok"]').has('span.currency-image > img[title!="chaos"]').each(((e,t)=>{let a=B(t)[2];$(t).append(`<br/><span>&#8776;</span> <span>${a}<span>×</span><span><img src="https://web.poecdn.com/image/Art/2DItems/Currency/CurrencyRerollRare.png" alt="chaos" title="chaos"></span></span>`),t.setAttribute("helper-checked","ok")}));let t=function(){let e=$("div.search-advanced-pane.brown div.filter-group.expanded div.filter.full-span:not(.disabled) div.filter-title"),t=[];return e.each(((e,a)=>{var n;let o=null==(n=$(a).contents()[1].textContent)?void 0:n.trim();o=null==o?void 0:o.replace(/[\\+\\-]?#/g,"[\\+\\-]?[0-9.]+"),o&&t.push(o)})),t}();$('div[data-mod] span[data-field][helper-checked!="ok"]').each(((e,a)=>{for(const n of t)if(n&&a.textContent&&RegExp(n).test(a.textContent)){a.style.backgroundColor="#484703",a.style.color="#e2e2e2",a.setAttribute("helper-checked","ok");break}}))}}),2e3)}function B(e){var t;let a=e.querySelectorAll("span"),n=a[1].textContent,o=null==(t=a[3].querySelector("span"))?void 0:t.textContent,r=0;if("Chaos Orb"!==o&&_){for(const e of _.lines)if(e.currencyTypeName===o){r=e.chaosEquivalent;break}return[n,o,(parseFloat(n)*r).toFixed(2)]}return[n,o]}function O(e){var t;const[a,n,o]=B(e.parentElement.querySelector('span[data-field="price"]')),r=null==(t=_.currencyDetails.find((e=>e.name.toLowerCase()===(null==n?void 0:n.toLowerCase()))))?void 0:t.icon;return c.createElement("div",null,c.createElement("div",{dangerouslySetInnerHTML:{__html:e.itemElement.outerHTML}}),c.createElement("div",{style:{padding:".5em",backgroundColor:"#000"}},"Price: ",a," ",r?c.createElement(c.Fragment,null,"× ",c.createElement("img",{src:r,width:"28px"})):n,o&&c.createElement(c.Fragment,null," ≈ ",o," × ",c.createElement("img",{src:"https://web.poecdn.com/image/Art/2DItems/Currency/CurrencyRerollRare.png",width:"28px"})),c.createElement("br",null)),c.createElement("button",{className:"helper-btn",onClick:()=>e.removePin(e.index)},"Remove"),c.createElement("button",{className:"helper-btn",onClick:()=>function(){let t=e.parentElement.getBoundingClientRect(),a=Math.floor(window.innerHeight/2-t.height/2),n=Math.floor(t.top-a);Math.floor(t.top)!=a&&(window.scrollBy(0,n),e.parentElement.style.transition="background 0.5s linear",e.parentElement.style.background="#ffffff50",setTimeout((()=>{e.parentElement.style.background=""}),500))}()},"Scroll to"),c.createElement("hr",null))}function L(){const e=l.exports.useState(0)[1],t=()=>e((e=>e+1)),a=l.exports.useRef([]);function n(e){e>=0&&e<a.current.length&&(a.current.splice(e,1),t())}l.exports.useEffect((()=>{!async function(e){var t,a;let n=e||(null==(t=document.querySelector("span.multiselect__single"))?void 0:t.textContent);for(;void 0===n;)await g(2e3),n=null==(a=document.querySelector("span.multiselect__single"))?void 0:a.textContent;SendGetRequest(`https://poe.ninja/api/data/currencyoverview?league=${n}&type=Currency`).then((e=>{_=e})).catch((e=>{console.error("Failed updating prices:",e)}))}(),I(o)}),[]);const o=e=>{var n,o,r,l;let c=null==(l=null==(r=null==(o=null==(n=e.currentTarget.parentElement)?void 0:n.parentElement)?void 0:o.parentElement)?void 0:r.parentElement)?void 0:l.parentElement,s=c.querySelector("div.itemPopupContainer");$(s).css("margin","0px"),$(s).css("margin-top","0.5em"),a.current.push([s,c]),t()};return c.createElement(c.Fragment,null,a.current.map((e=>c.createElement(O,{key:a.current.indexOf(e),index:a.current.indexOf(e),itemElement:e[0],parentElement:e[1],removePin:n}))))}const T=class{constructor(){r(this,"callbacks",[]),r(this,"fontSize",1.1),r(this,"helperWidth",390)}AddListener(e){this.callbacks.push(e)}Save(){window.localStorage.setItem(f,JSON.stringify(this,((e,t)=>{if("callbacks"!==e)return t}))),this.callbacks.forEach((e=>e()))}static get Instance(){if(!this._instance){this._instance=new T;let e,t=window.localStorage.getItem(f);t&&(e=Object.assign(new T,JSON.parse(t)))&&e&&(this._instance=e)}return this._instance}};let P=T;function A(){const[e,t]=l.exports.useState(P.Instance.fontSize),[a,n]=l.exports.useState(P.Instance.helperWidth);return c.createElement(c.Fragment,null,c.createElement(i.Group,null,c.createElement(i.Label,null,"Font size:")," ",e,c.createElement(i.Range,{min:.8,max:2,step:.05,defaultValue:e,onChange:function(e){const a=parseFloat(e.currentTarget.value);t(a),P.Instance.fontSize=a,P.Instance.Save()}})),c.createElement(i.Group,null,c.createElement(i.Label,null,"Width:")," ",a,"px",c.createElement(i.Control,{type:"number",step:10,defaultValue:a,onChange:function(e){const t=parseInt(e.currentTarget.value);n(t),P.Instance.helperWidth=t,P.Instance.Save()}})))}r(P,"_instance");function H(e){const t={display:e.isOpen?"block":"none"};return c.createElement("div",{id:"helper-tabs",style:t},c.createElement("ul",{className:"nav nav-tabs px-1",role:"tablist"},c.createElement("li",{className:"nav-item",role:"presentation"},c.createElement("button",{className:"nav-link active",id:"bookmark-tab","data-bs-toggle":"tab","data-bs-target":"#bookmark",type:"button",role:"tab","aria-controls":"bookmark","aria-selected":"true"},c.createElement("i",{className:"bi bi-bookmark-star-fill"})," Bookmarks")),c.createElement("li",{className:"nav-item",role:"presentation"},c.createElement("button",{className:"nav-link",id:"pins-tab","data-bs-toggle":"tab","data-bs-target":"#pins",type:"button",role:"tab","aria-controls":"pins","aria-selected":"false"},c.createElement("i",{className:"bi bi-pin-angle-fill"})," Pins")),c.createElement("li",{className:"nav-item",role:"presentation"},c.createElement("button",{className:"nav-link",id:"history-tab","data-bs-toggle":"tab","data-bs-target":"#history",type:"button",role:"tab","aria-controls":"history","aria-selected":"false"},c.createElement("i",{className:"bi bi-clock-history"})," History")),c.createElement("li",{className:"nav-item",role:"presentation"},c.createElement("button",{className:"nav-link",id:"settings-tab","data-bs-toggle":"tab","data-bs-target":"#settings",type:"button",role:"tab","aria-controls":"settings","aria-selected":"false"},c.createElement("i",{className:"bi bi-gear-fill"})," Settings"))),c.createElement("div",{className:"tab-content"},c.createElement("div",{className:"tab-pane overflow-auto active",id:"bookmark",role:"tabpanel","aria-labelledby":"bookmark-tab"},c.createElement(C,null)),c.createElement("div",{className:"tab-pane overflow-auto",id:"pins",role:"tabpanel","aria-labelledby":"pins-tab"},c.createElement(L,null)),c.createElement("div",{className:"tab-pane overflow-auto",id:"history",role:"tabpanel","aria-labelledby":"history-tab"},c.createElement(F,null)),c.createElement("div",{className:"tab-pane overflow-auto",id:"settings",role:"tabpanel","aria-labelledby":"settings-tab"},c.createElement(A,null))))}function R(){const[e,r]=l.exports.useState(!1),[s,i]=l.exports.useState({height:"fit-content",fontSize:`${P.Instance.fontSize}em`,width:`${P.Instance.helperWidth}px`});function m(){const t=document.querySelector("div#app > div.content");t&&(t.style.width=e?"100%":`calc(100% - ${P.Instance.helperWidth}px)`);const a=new Boolean(e);i((e=>(e.height=a?"fit-content":"100vh",e))),r((e=>!e))}function d(){i((e=>{const r=((e,r)=>{for(var l in r||(r={}))a.call(r,l)&&o(e,l,r[l]);if(t)for(var l of t(r))n.call(r,l)&&o(e,l,r[l]);return e})({},e);return r.fontSize=`${P.Instance.fontSize}em`,r.width=`${P.Instance.helperWidth}px`,r}));const e=document.body.querySelector("div#app > div.content");e&&(e.style.width=`calc(100% - ${P.Instance.helperWidth}px)`)}return l.exports.useEffect((()=>{m(),async function(){let e;do{await g(1e3),e=document.querySelector("div.brown")}while(!e);e.addEventListener("click",(async()=>{var e;let t=0;for(;"input"!==(null==(e=document.activeElement)?void 0:e.tagName.toLowerCase())&&++t<5;)await g(100);let a=document.activeElement;a&&a.classList.contains("multiselect__input")&&!a.classList.contains("helper_checked")&&(a.addEventListener("input",(async e=>{await g(2);const t=e.target;/^[a-z]/.test(t.value)&&(t.value="~"+t.value)})),a.classList.add("helper_checked"))})),console.log("Add tilda done!")}(),P.Instance.AddListener(d)}),[]),c.createElement("div",{className:"PoETradeHelper",style:s},c.createElement("button",{className:"helper-btn",onClick:()=>m()},"Show/Hide"),c.createElement(H,{isOpen:e}))}b.render(c.createElement(c.StrictMode,null,c.createElement(R,null)),document.getElementById("PoETradeHelper"));
