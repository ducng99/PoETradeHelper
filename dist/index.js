var e=Object.defineProperty,t=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(t,a,o)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):t[a]=o,n=(e,n)=>{for(var l in n||(n={}))a.call(n,l)&&r(e,l,n[l]);if(t)for(var l of t(n))o.call(n,l)&&r(e,l,n[l]);return e},l=(e,t,a)=>(r(e,"symbol"!=typeof t?t+"":t,a),a);import{r as c,R as s,M as i,F as m,B as d,v as u,a as b,b as k}from"./vendor.js";!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver((e=>{for(const a of e)if("childList"===a.type)for(const e of a.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)})).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerpolicy&&(t.referrerPolicy=e.referrerpolicy),"use-credentials"===e.crossorigin?t.credentials="include":"anonymous"===e.crossorigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();var p="PoETradeHelper_Bookmarks",f="PoETradeHelper_History",h="PoETradeHelper_Settings";class E extends Array{constructor(...e){super(...e)}s_push(e,...t){const a=t.filter((t=>!this.find((a=>e(t,a)))));return this.push(...a),this.length}}function g(e){if(e&&7===e.length){return(299*parseInt(e.substr(1,2),16)+587*parseInt(e.substr(3,2),16)+114*parseInt(e.substr(5,2),16))/1e3>=127.5?"#000":"#e2e2e2"}return"#000"}function y(e){return new Promise((t=>{setTimeout(t,e)}))}function v(e){const[t,a]=c.exports.useState(e.bookmarkFolder?e.bookmarkFolder.name:""),[o,r]=c.exports.useState(e.bookmarkFolder?e.bookmarkFolder.bgColor:"#133d62");return s.createElement(i,{show:e.show,onHide:()=>e.setShow(!1),animation:!1},s.createElement(i.Header,{closeButton:!0},s.createElement(i.Title,null,e.bookmarkFolder?"Edit":"Create"," a folder")),s.createElement(i.Body,null,s.createElement(m.Group,{className:"mb-3"},s.createElement(m.Label,{htmlFor:"add_bookmarkFolder_name"},"Name:"),s.createElement(m.Control,{id:"add_bookmarkFolder_name",defaultValue:t,onChange:e=>a(e.currentTarget.value)})),s.createElement(m.Group,{className:"mb-3"},s.createElement(m.Label,{htmlFor:"add_bookmarkFolder_color"},"Background color:"),s.createElement(m.Control,{id:"add_bookmarkFolder_color",defaultValue:o,type:"color",onInput:e=>r(e.currentTarget.value)}))),s.createElement(i.Footer,null,s.createElement(d,{variant:"primary",onClick:function(){t&&o&&(e.bookmarkFolder&&e.editBookmarkFolder?(e.bookmarkFolder.name=t,e.bookmarkFolder.bgColor=o,e.editBookmarkFolder(e.bookmarkFolder)):e.addBookmarkFolder&&e.addBookmarkFolder({id:u(),name:t,bgColor:o,bookmarks:new E}),e.setShow(!1))}},e.bookmarkFolder?"Save":"Add")))}function w(e){const[t,a]=c.exports.useState(e.bookmark?e.bookmark.name:""),[o,r]=c.exports.useState(e.bookmark?e.bookmark.url:window.location.href),[n,l]=c.exports.useState(e.bookmark?e.bookmark.bgColor:"#222222");return c.exports.useEffect((()=>{let t=$("input.multiselect__input");e.bookmark||a(t[0].value?t[0].value:"Any"===t[1].value?"":t[1].value)}),[]),s.createElement(i,{show:e.show,onHide:()=>e.setShow(!1),animation:!1},s.createElement(i.Header,{closeButton:!0},s.createElement(i.Title,null,e.bookmark?"Edit":"Create"," a bookmark")),s.createElement(i.Body,null,s.createElement(m.Group,{className:"mb-3"},s.createElement(m.Label,{htmlFor:"add_bookmark_name"},"Name:"),s.createElement(m.Control,{id:"add_bookmark_name",defaultValue:t,onChange:e=>a(e.currentTarget.value)})),s.createElement(m.Group,{className:"mb-3"},s.createElement(m.Label,{htmlFor:"add_bookmark_url"},"URL:"),s.createElement(m.Control,{id:"add_bookmark_url",defaultValue:o,onChange:e=>r(e.currentTarget.value)})),s.createElement(m.Group,{className:"mb-3"},s.createElement(m.Label,{htmlFor:"add_bookmark_color"},"Background color:"),s.createElement(m.Control,{id:"add_bookmark_color",defaultValue:n,type:"color",onInput:e=>l(e.currentTarget.value)}))),s.createElement(i.Footer,null,s.createElement(d,{variant:"primary",onClick:function(){t&&o&&n&&(e.bookmark&&e.editBookmark?(e.bookmark.name=t,e.bookmark.url=o,e.bookmark.bgColor=n,e.editBookmark(e.bookmark)):e.addBookmark&&e.addBookmark({id:u(),name:t,url:o,bgColor:n}),e.setShow(!1))}},e.bookmark?"Save":"Add")))}function N(e){const[t,a]=c.exports.useState(!1),o={backgroundColor:e.bookmark.bgColor,color:g(e.bookmark.bgColor)};return s.createElement("div",{className:"d-flex"},s.createElement("a",{href:e.bookmark.url,className:"flex-grow-1 p-1 bookmark-entry",style:o},e.bookmark.name),s.createElement("button",{className:"helper-btn",onClick:()=>e.moveBookmark(e.bookmark,-1)},s.createElement("i",{className:"bi bi-chevron-up"})),s.createElement("button",{className:"helper-btn",onClick:()=>e.moveBookmark(e.bookmark,1)},s.createElement("i",{className:"bi bi-chevron-down"})),s.createElement("button",{className:"helper-btn",onClick:()=>a(!0)},s.createElement("i",{className:"bi bi-pencil-fill"})),s.createElement("button",{className:"helper-btn",onClick:()=>e.deleteBookmark(e.bookmark)},s.createElement("i",{className:"bi bi-trash"})),t&&s.createElement(w,{show:t,setShow:a,editBookmark:e.editBookmark,bookmark:e.bookmark}))}function S(e){const[t,a]=c.exports.useState(!1),[o,r]=c.exports.useState(!1),n={backgroundColor:e.folder.bgColor,color:g(e.folder.bgColor)};function l(t){const a=e.folder.bookmarks.findIndex((e=>e.id===t.id));-1!==a&&(e.folder.bookmarks.splice(a,1),e.updateBookmarkFolder(e.folder))}function i(t){const a=e.folder.bookmarks.findIndex((e=>e.id===t.id));-1!==a&&(e.folder.bookmarks[a]=t,e.updateBookmarkFolder(e.folder))}function m(t,a){const o=e.folder.bookmarks.findIndex((e=>e.id===t.id)),r=o+a;-1!==o&&r>=0&&r<e.folder.bookmarks.length&&(b(e.folder.bookmarks,o,r),e.updateBookmarkFolder(e.folder))}return s.createElement("div",{className:"accordion-item mt-1"},s.createElement("h2",{className:"accordion-header",id:"header_"+e.folder.id},s.createElement("button",{className:"accordion-button collapsed",type:"button",style:n,"data-bs-toggle":"collapse","data-bs-target":"#content_"+e.folder.id,"aria-expanded":"false","aria-controls":"content_"+e.folder.id},s.createElement("div",{className:"me-auto"},e.folder.name),s.createElement("button",{className:"helper-btn",onClick:()=>e.moveBookmarkFolder(e.folder,-1)},s.createElement("i",{className:"bi bi-chevron-up"})),s.createElement("button",{className:"helper-btn",onClick:()=>e.moveBookmarkFolder(e.folder,1)},s.createElement("i",{className:"bi bi-chevron-down"})),s.createElement("button",{className:"helper-btn",onClick:()=>r(!0)},s.createElement("i",{className:"bi bi-pencil-fill"})),s.createElement("button",{className:"helper-btn",onClick:()=>e.deleteBookmarkFolder(e.folder)},s.createElement("i",{className:"bi bi-trash"})),o&&s.createElement(v,{show:o,setShow:r,editBookmarkFolder:e.updateBookmarkFolder,bookmarkFolder:e.folder}))),s.createElement("div",{id:"content_"+e.folder.id,className:"accordion-collapse collapse","aria-labelledby":"header_"+e.folder.id},s.createElement("div",{className:"accordion-body"},e.folder.bookmarks.map((e=>s.createElement(N,{key:e.id,bookmark:e,deleteBookmark:l,moveBookmark:m,editBookmark:i}))),s.createElement("button",{className:"helper-btn w-100",onClick:()=>a(!0)},"Add new bookmark"),t&&s.createElement(w,{show:t,setShow:a,addBookmark:function(t){e.folder.bookmarks.s_push(C,t),e.updateBookmarkFolder(e.folder)}}))))}const C=(e,t)=>e.id===t.id;function x(){const[e,t]=c.exports.useState(new E),[a,o]=c.exports.useState(!1),r=c.exports.useRef(null);function n(a){const o=new E(...e),r=o.findIndex((e=>e.id===a.id));-1!==r&&(o[r]=a,window.localStorage.setItem(p,JSON.stringify(o)),t(o))}function l(a){const o=new E(...e),r=o.findIndex((e=>e.id===a.id));-1!==r&&(o.splice(r,1),window.localStorage.setItem(p,JSON.stringify(o)),t(o))}function i(a,o){const r=new E(...e),n=r.findIndex((e=>e.id===a.id)),l=n+o;-1!==n&&l>=0&&l<r.length&&(b(r,n,l),window.localStorage.setItem(p,JSON.stringify(r)),t(r))}return c.exports.useEffect((()=>{const a=window.localStorage.getItem(p);a?t(JSON.parse(a)):window.localStorage.setItem(p,JSON.stringify(e))}),[]),s.createElement(s.Fragment,null,s.createElement("div",{className:"d-flex"},s.createElement("button",{className:"helper-btn me-auto",onClick:function(){o(!0)}},"Create a folder"),s.createElement("input",{ref:r,type:"file",style:{display:"none"},onChange:async function(e){const a=e.currentTarget.files;if(a&&a.length>0){console.log(a);const e=await(o=a[0],new Promise((e=>{let t=new FileReader;t.onload=a=>{t.result&&e(t.result.toString())},t.readAsText(o)})));if(e){console.log(e);try{const a=JSON.parse(e);window.localStorage.setItem(p,e),t(new E(...a))}catch{}}}var o}}),s.createElement("button",{className:"helper-btn",onClick:()=>{var e;return null==(e=r.current)?void 0:e.click()}},"Import"),s.createElement("button",{className:"helper-btn",onClick:function(){!function(e,t){const a=document.createElement("a");a.setAttribute("href","data:text/plain;charset=utf-8;base64,"+btoa(t)),a.setAttribute("download",e),document.body.appendChild(a),a.click(),document.body.removeChild(a)}("PoETradeHelper_Bookmarks.json",JSON.stringify(e))}},"Export")),s.createElement("hr",null),s.createElement("div",{className:"accordion"},e.map((e=>s.createElement(S,{key:e.id,folder:e,updateBookmarkFolder:n,deleteBookmarkFolder:l,moveBookmarkFolder:i})))),a&&s.createElement(v,{show:a,setShow:o,addBookmarkFolder:function(a){const o=new E(...e);o.s_push(C,a),window.localStorage.setItem(p,JSON.stringify(o)),t(o)}}))}function F(e){return s.createElement("div",{className:"history-entry"},s.createElement("a",{href:e.entry.url,style:{flexGrow:1}},s.createElement("div",{className:"d-flex"},s.createElement("b",{className:"history-title"},e.entry.title),s.createElement("small",{className:"ms-auto"},function(e){let t=new Date,a=t.getTime();t.setDate(0);let o=a-e;if(o<36e5){let e=Math.floor(o/1e3/60);return e+" minute"+(e<=1?"":"s")+" ago"}if(o<864e5){let e=Math.floor(o/1e3/60/60);return e+" hour"+(e<=1?"":"s")+" ago"}if(o<864e5*t.getDate()){let e=Math.floor(o/1e3/60/60/24);return e+" day"+(e<=1?"":"s")+" ago"}return"a long time ago"}(e.entry.time))),s.createElement("small",{style:{color:"gray"}},"...",e.entry.url.substring(e.entry.url.indexOf("/trade/")))))}function _(){const e=c.exports.useState(0)[1],t=()=>e((e=>e+1)),a=c.exports.useRef([]);function o(e){if("click"===e.type||"keydown"===e.type&&"Enter"===e.key){let e=setInterval((()=>{if(/\/trade\/search\/\w+\/\w+/.test(window.location.pathname)&&(clearInterval(e),0==a.current.length||a.current[a.current.length-1].url!==window.location.href)){let e=$("input.multiselect__input"),o=e[0].value?e[0].value:e[1].value;a.current.push({id:u(),title:o,url:window.location.href,time:Date.now()}),window.localStorage.setItem(f,JSON.stringify(a.current)),t()}}),1e3)}}return c.exports.useEffect((()=>{const e=window.localStorage.getItem(f);if(e){let t=JSON.parse(e);a.current.push(...t)}else window.localStorage.setItem(f,JSON.stringify(a.current));!async function(e){document.body.addEventListener("keydown",e);let t=document.body.querySelector("button.search-btn");for(;!t;)await y(1e3);t.addEventListener("click",e)}(o)}),[]),s.createElement("div",null,s.createElement("button",{className:"helper-btn",onClick:function(){a.current.splice(0,a.current.length),window.localStorage.setItem(f,JSON.stringify(a.current)),t()}},"Clear"),s.createElement("hr",null),a.current.slice().reverse().map((e=>s.createElement(F,{entry:e}))))}let I;function B(e){setInterval((()=>{if(-1===window.location.href.indexOf("exchange")){$(".results span.pull-left:not(.checked)").each(((t,a)=>{let o=$('<button class="btn btn-default whisper-btn">Pin</button>');o.on("click",e),$(a).append(o),$(a).addClass("checked")})),$('span[data-field="price"][helper-checked!="ok"]').has('span.currency-image > img[title!="chaos"]').each(((e,t)=>{let a=O(t)[2];$(t).append(`<br/><span>&#8776;</span> <span>${a}<span>×</span><span><img src="https://web.poecdn.com/image/Art/2DItems/Currency/CurrencyRerollRare.png" alt="chaos" title="chaos"></span></span>`),t.setAttribute("helper-checked","ok")}));let t=function(){let e=$("div.search-advanced-pane.brown div.filter-group.expanded div.filter.full-span:not(.disabled) div.filter-title"),t=[];return e.each(((e,a)=>{var o;let r=null==(o=$(a).contents()[1].textContent)?void 0:o.trim();r=null==r?void 0:r.replace(/[\\+\\-]?#/g,"[\\+\\-]?[0-9.]+"),r&&t.push(r)})),t}();$('div[data-mod] span[data-field][helper-checked!="ok"]').each(((e,a)=>{for(const o of t)if(o&&a.textContent&&RegExp(o).test(a.textContent)){a.style.backgroundColor="#484703",a.style.color="#e2e2e2",a.setAttribute("helper-checked","ok");break}}))}}),2e3)}function O(e){var t;let a=e.querySelectorAll("span"),o=a[1].textContent,r=null==(t=a[3].querySelector("span"))?void 0:t.textContent,n=0;if("Chaos Orb"!==r&&I){for(const e of I.lines)if(e.currencyTypeName===r){n=e.chaosEquivalent;break}return[o,r,(parseFloat(o)*n).toFixed(2)]}return[o,r]}function L(e){var t;const[a,o,r]=O(e.parentElement.querySelector('span[data-field="price"]')),n=null==(t=I.currencyDetails.find((e=>e.name.toLowerCase()===(null==o?void 0:o.toLowerCase()))))?void 0:t.icon;return s.createElement("div",null,s.createElement("div",{dangerouslySetInnerHTML:{__html:e.itemElement.outerHTML}}),s.createElement("div",{style:{padding:".5em",backgroundColor:"#000"}},"Price: ",a," ",n?s.createElement(s.Fragment,null,"× ",s.createElement("img",{src:n,width:"28px"})):o,r&&s.createElement(s.Fragment,null," ≈ ",r," × ",s.createElement("img",{src:"https://web.poecdn.com/image/Art/2DItems/Currency/CurrencyRerollRare.png",width:"28px"})),s.createElement("br",null)),s.createElement("button",{className:"helper-btn",onClick:()=>e.removePin(e.index)},"Remove"),s.createElement("button",{className:"helper-btn",onClick:()=>function(){let t=e.parentElement.getBoundingClientRect(),a=Math.floor(window.innerHeight/2-t.height/2),o=Math.floor(t.top-a);Math.floor(t.top)!=a&&(window.scrollBy(0,o),e.parentElement.style.transition="background 0.5s linear",e.parentElement.style.background="#ffffff50",setTimeout((()=>{e.parentElement.style.background=""}),500))}()},"Scroll to"),s.createElement("hr",null))}function T(){const e=c.exports.useState(0)[1],t=()=>e((e=>e+1)),a=c.exports.useRef([]);function o(e){e>=0&&e<a.current.length&&(a.current.splice(e,1),t())}c.exports.useEffect((()=>{!async function(e){var t,a;let o=e||(null==(t=document.querySelector("span.multiselect__single"))?void 0:t.textContent);for(;void 0===o;)await y(2e3),o=null==(a=document.querySelector("span.multiselect__single"))?void 0:a.textContent;SendGetRequest(`https://poe.ninja/api/data/currencyoverview?league=${o}&type=Currency`).then((e=>{I=e})).catch((e=>{console.error("Failed updating prices:",e)}))}(),B(r)}),[]);const r=e=>{var o,r,n,l;let c=null==(l=null==(n=null==(r=null==(o=e.currentTarget.parentElement)?void 0:o.parentElement)?void 0:r.parentElement)?void 0:n.parentElement)?void 0:l.parentElement,s=c.querySelector("div.itemPopupContainer");$(s).css("margin","0px"),$(s).css("margin-top","0.5em"),a.current.push([s,c]),t()};return s.createElement(s.Fragment,null,a.current.map((e=>s.createElement(L,{key:a.current.indexOf(e),index:a.current.indexOf(e),itemElement:e[0],parentElement:e[1],removePin:o}))))}const A=class{constructor(){l(this,"callbacks",[]),l(this,"fontSize",1.1),l(this,"helperWidth",390)}AddListener(e){this.callbacks.push(e)}Save(){window.localStorage.setItem(h,JSON.stringify(this,((e,t)=>{if("callbacks"!==e)return t}))),this.callbacks.forEach((e=>e()))}static get Instance(){if(!this._instance){this._instance=new A;let e,t=window.localStorage.getItem(h);t&&(e=Object.assign(new A,JSON.parse(t)))&&e&&(this._instance=e)}return this._instance}};let P=A;function H(){const[e,t]=c.exports.useState(P.Instance.fontSize),[a,o]=c.exports.useState(P.Instance.helperWidth);return s.createElement(s.Fragment,null,s.createElement(m.Group,null,s.createElement(m.Label,null,"Font size:")," ",e,s.createElement(m.Range,{min:.8,max:2,step:.05,defaultValue:e,onChange:function(e){const a=parseFloat(e.currentTarget.value);t(a),P.Instance.fontSize=a,P.Instance.Save()}})),s.createElement(m.Group,null,s.createElement(m.Label,null,"Width:")," ",a,"px",s.createElement(m.Control,{type:"number",min:300,max:600,step:10,defaultValue:a,onChange:function(e){const t=parseInt(e.currentTarget.value);o(t),P.Instance.helperWidth=t,P.Instance.Save()}})))}l(P,"_instance");function R(e){const t={display:e.isOpen?"block":"none"};return s.createElement("div",{id:"helper-tabs",style:t},s.createElement("ul",{className:"nav nav-tabs px-1",role:"tablist"},s.createElement("li",{className:"nav-item",role:"presentation"},s.createElement("button",{className:"nav-link active",id:"bookmark-tab","data-bs-toggle":"tab","data-bs-target":"#bookmark",type:"button",role:"tab","aria-controls":"bookmark","aria-selected":"true"},s.createElement("i",{className:"bi bi-bookmark-star-fill"})," Bookmarks")),s.createElement("li",{className:"nav-item",role:"presentation"},s.createElement("button",{className:"nav-link",id:"pins-tab","data-bs-toggle":"tab","data-bs-target":"#pins",type:"button",role:"tab","aria-controls":"pins","aria-selected":"false"},s.createElement("i",{className:"bi bi-pin-angle-fill"})," Pins")),s.createElement("li",{className:"nav-item",role:"presentation"},s.createElement("button",{className:"nav-link",id:"history-tab","data-bs-toggle":"tab","data-bs-target":"#history",type:"button",role:"tab","aria-controls":"history","aria-selected":"false"},s.createElement("i",{className:"bi bi-clock-history"})," History")),s.createElement("li",{className:"nav-item",role:"presentation"},s.createElement("button",{className:"nav-link",id:"settings-tab","data-bs-toggle":"tab","data-bs-target":"#settings",type:"button",role:"tab","aria-controls":"settings","aria-selected":"false"},s.createElement("i",{className:"bi bi-gear-fill"})," Settings"))),s.createElement("div",{className:"tab-content"},s.createElement("div",{className:"tab-pane overflow-auto active",id:"bookmark",role:"tabpanel","aria-labelledby":"bookmark-tab"},s.createElement(x,null)),s.createElement("div",{className:"tab-pane overflow-auto",id:"pins",role:"tabpanel","aria-labelledby":"pins-tab"},s.createElement(T,null)),s.createElement("div",{className:"tab-pane overflow-auto",id:"history",role:"tabpanel","aria-labelledby":"history-tab"},s.createElement(_,null)),s.createElement("div",{className:"tab-pane overflow-auto",id:"settings",role:"tabpanel","aria-labelledby":"settings-tab"},s.createElement(H,null))))}function J(){const[e,t]=c.exports.useState(!1),[a,o]=c.exports.useState({height:"fit-content",fontSize:P.Instance.fontSize+"em"});function r(){t(!e);const r=document.querySelector("div#app > div.content");r&&(r.style.width=e?"100%":"calc(100% - var(--helper-width))"),o(Object.assign(n({},a),{height:e?"fit-content":"100vh"}))}function l(){o(Object.assign(n({},a),{fontSize:P.Instance.fontSize+"em"})),document.body.setAttribute("style",`--helper-width: ${P.Instance.helperWidth}px`)}return c.exports.useEffect((()=>{r(),async function(){let e;do{await y(1e3),e=document.querySelector("div.brown")}while(!e);e.addEventListener("click",(async()=>{var e;let t=0;for(;"input"!==(null==(e=document.activeElement)?void 0:e.tagName.toLowerCase())&&++t<5;)await y(100);let a=document.activeElement;a&&a.classList.contains("multiselect__input")&&!a.classList.contains("helper_checked")&&(a.addEventListener("input",(async e=>{await y(2);const t=e.target;/^[a-z]/.test(t.value)&&(t.value="~"+t.value)})),a.classList.add("helper_checked"))})),console.log("Add tilda done!")}(),document.body.setAttribute("style",`--helper-width: ${P.Instance.helperWidth}px`),P.Instance.AddListener(l)}),[]),s.createElement("div",{className:"PoETradeHelper",style:a},s.createElement("button",{className:"helper-btn",onClick:()=>r()},"Show/Hide"),s.createElement(R,{isOpen:e}))}k.render(s.createElement(s.StrictMode,null,s.createElement(J,null)),document.getElementById("PoETradeHelper"));
